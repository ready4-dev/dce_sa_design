---
title: "XX_Funs"
output: html_document
date: '2022-06-08'
---

```{r echo=TRUE}
add_design_spec <- function(dce_design_ls = list(),
                            alternatives_chr = character(0),
                            att_lvls_tb = tibble::tibble(),
                            block_indcs_ls = list(),
                            design_mat = matrix(),
                            nbr_of_sets_1L_int = integer(0),
                            nbr_of_blocks_1L_int = integer(0),
                            opt_out_1L_lgl = logical(0)){
  if(!identical(block_indcs_ls, list())){
        if(identical(nbr_of_blocks_1L_int, integer(0))){
      nbr_of_blocks_1L_int <- length(block_indcs_ls)
    }else{
      assertthat::are_equal(length(block_indcs_ls), nbr_of_blocks_1L_int)
    }
  }
  if(is.null(dce_design_ls$choice_sets_ls)){
        dce_design_ls$choice_sets_ls <- list(alternatives_chr = alternatives_chr,
                                             att_lvls_tb = att_lvls_tb,
                                             nbr_of_sets_1L_int = nbr_of_sets_1L_int,
                                             nbr_of_blocks_1L_int = nbr_of_blocks_1L_int,
                                             opt_out_1L_lgl = opt_out_1L_lgl)
  }
  if(!identical(alternatives_chr,character(0))){
    dce_design_ls$choice_sets_ls$alternatives_chr <- alternatives_chr
  }
  if(!identical(att_lvls_tb, tibble::tibble())){
    dce_design_ls$choice_sets_ls$att_lvls_tb <- att_lvls_tb
  }
  if(!identical(block_indcs_ls, list())){
    dce_design_ls$block_indcs_ls <- block_indcs_ls
  }
  if(!identical(design_mat, matrix())){
    dce_design_ls$design_mat <- design_mat
  }
  if(!identical(nbr_of_sets_1L_int, integer(0))){
    dce_design_ls$choice_sets_ls$nbr_of_sets_1L_int <- nbr_of_sets_1L_int
  }
  if(!identical(nbr_of_blocks_1L_int, integer(0))){
    dce_design_ls$choice_sets_ls$nbr_of_blocks_1L_int <- nbr_of_blocks_1L_int
  }
  if(!identical(opt_out_1L_lgl,logical(0))){
    dce_design_ls$choice_sets_ls$opt_out_1L_lgl <- opt_out_1L_lgl
  }
  return(dce_design_ls)
}
```
```{r}
get_att_smrys <- function(dce_design_ls,
                          return_1L_chr = "levels"){
   att_smry_tb <- dce_design_ls$choice_sets_ls$att_lvls_tb %>% dplyr::group_by(attribute_chr) %>% dplyr::summarise(levels = dplyr::n(), type = dplyr::first(continuous_lgl) %>% ifelse("C","D"))
   return_xx  <- get_atts(dce_design_ls$choice_sets_ls$att_lvls_tb) %>%
     purrr::map(~ready4::get_from_lup_obj(att_smry_tb,
                                              match_var_nm_1L_chr = "attribute_chr",
                                              match_value_xx = .x,
                                              target_var_nm_1L_chr = return_1L_chr))
   if(return_1L_chr == "levels")
     return_xx <- return_xx %>% purrr::flatten_int()
      if(return_1L_chr == "type")
     return_xx <- return_xx %>% purrr::flatten_chr()
   return(return_xx)
}
```

